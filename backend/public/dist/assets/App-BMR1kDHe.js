import{r as g,j as e,a as L,u as I,b as F,L as C,O as z}from"./index-DgWF9MBv.js";import{A}from"./index-Bh9Nv_jl.js";import{m}from"./proxy-C2YUrH8b.js";const T=({currentAvatar:b,onAvatarUpdate:v})=>{const[i,u]=g.useState(!1),[f,y]=g.useState([]),[o,h]=g.useState(null),[w,j]=g.useState(!1),[s,k]=g.useState(!1),[r,a]=g.useState(null);g.useEffect(()=>{i&&l()},[i]);const l=async()=>{j(!0),a(null);try{const t=[];for(let n=1;n<=9;n++)t.push(`https://molsongbsspaces.onrender.com/images/av${n}.png`);y(t)}catch{a("Failed to load avatars. Please try again.")}finally{j(!1)}},p=async()=>{if(o){k(!0),a(null);try{const t=JSON.parse(localStorage.getItem("user")),n=t?._id||t?.id,d=localStorage.getItem("token"),c=await fetch(`https://molsongbsspaces.onrender.com/api/user/${n}`,{method:"PUT",headers:{"Content-Type":"application/json",Authorization:`Bearer ${d}`},body:JSON.stringify({image:o})});if(!c.ok){const M=await c.text();throw console.error("Server response:",M),new Error(`Failed to update avatar: ${c.status} ${c.statusText}`)}let D;const S=c.headers.get("content-type");S&&S.includes("application/json")&&(D=await c.json()),v&&v(o),u(!1),h(null)}catch(t){console.error("Avatar update error:",t),a(t.message||"Failed to save avatar. Please try again.")}finally{k(!1)}}},x=()=>{u(!1),h(null),a(null)};return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>u(!0),style:{display:"flex",alignItems:"center",justifyContent:"center",gap:"0.5rem",width:"100%",padding:"0.75rem 1rem",background:"rgba(0, 103, 172, 0.2)",color:"#F6DD58",border:"1px solid rgba(246, 221, 88, 0.3)",borderRadius:"8px",fontSize:"0.875rem",fontWeight:"600",cursor:"pointer",transition:"all 0.3s ease"},onMouseEnter:t=>{t.target.style.background="rgba(0, 103, 172, 0.3)",t.target.style.borderColor="#F6DD58"},onMouseLeave:t=>{t.target.style.background="rgba(0, 103, 172, 0.2)",t.target.style.borderColor="rgba(246, 221, 88, 0.3)"},children:[e.jsx("svg",{width:"16",height:"16",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"})}),"Change Avatar"]}),i&&L.createPortal(e.jsx(A,{children:e.jsxs(e.Fragment,{children:[e.jsx(m.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},onClick:x,style:{position:"fixed",top:0,left:0,right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",backdropFilter:"blur(4px)",zIndex:9998,display:"flex",justifyContent:"center",alignItems:"center"}}),e.jsxs(m.div,{initial:{opacity:0,scale:.9,x:"-50%",y:"calc(-50% + 20px)"},animate:{opacity:1,scale:1,x:"-50%",y:"-50%"},exit:{opacity:0,scale:.9,x:"-50%",y:"calc(-50% + 20px)"},transition:{type:"spring",damping:25,stiffness:300},onClick:t=>t.stopPropagation(),style:{position:"fixed",top:"50%",left:"50%",background:"linear-gradient(to bottom, #2d3748, #1a202c)",borderRadius:"16px",border:"2px solid rgba(246, 221, 88, 0.3)",padding:"30px",width:"90%",maxWidth:"500px",maxHeight:"90vh",overflowY:"auto",zIndex:9999,boxShadow:"0 20px 60px rgba(0, 0, 0, 0.5)"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"25px",paddingBottom:"15px",borderBottom:"1px solid rgba(255, 255, 255, 0.1)"},children:[e.jsx("h2",{style:{fontSize:"24px",fontWeight:"bold",color:"#F6DD58",margin:0},children:"Change Avatar"}),e.jsx("button",{onClick:x,style:{background:"rgba(255, 255, 255, 0.1)",border:"1px solid rgba(255, 255, 255, 0.2)",fontSize:"24px",color:"#F6DD58",cursor:"pointer",padding:"0",width:"32px",height:"32px",display:"flex",alignItems:"center",justifyContent:"center",borderRadius:"50%",transition:"all 0.2s"},onMouseEnter:t=>{t.target.style.backgroundColor="rgba(246, 221, 88, 0.2)",t.target.style.borderColor="#F6DD58"},onMouseLeave:t=>{t.target.style.backgroundColor="rgba(255, 255, 255, 0.1)",t.target.style.borderColor="rgba(255, 255, 255, 0.2)"},children:"Ã—"})]}),e.jsxs("div",{style:{display:"flex",flexDirection:"column",alignItems:"center",marginBottom:"25px"},children:[e.jsx("div",{style:{width:"150px",height:"150px",borderRadius:"50%",overflow:"hidden",border:"4px solid #F6DD58",marginBottom:"20px",backgroundColor:"rgba(0, 103, 172, 0.2)",display:"flex",alignItems:"center",justifyContent:"center"},children:o?e.jsx("img",{src:o,alt:"Selected avatar",style:{width:"100%",height:"100%",objectFit:"cover"}}):b?e.jsx("img",{src:b,alt:"Current avatar",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{fontSize:"48px",color:"#F6DD58",fontWeight:"bold"},children:"?"})}),e.jsx("h3",{style:{fontSize:"16px",fontWeight:"600",color:"#F6DD58",marginBottom:"15px"},children:"Choose Your Avatar"}),w?e.jsx("div",{style:{padding:"40px",color:"#F6DD58",fontSize:"14px"},children:"Loading avatars..."}):e.jsx("div",{style:{display:"grid",gridTemplateColumns:"repeat(5, 1fr)",gap:"12px",width:"100%",marginBottom:"10px"},children:f.map((t,n)=>e.jsx("div",{onClick:()=>h(t),style:{width:"70px",height:"70px",borderRadius:"50%",overflow:"hidden",border:o===t?"3px solid #F6DD58":"3px solid rgba(255, 255, 255, 0.2)",cursor:"pointer",transition:"all 0.3s ease",backgroundColor:"rgba(0, 103, 172, 0.2)",boxShadow:o===t?"0 4px 12px rgba(246, 221, 88, 0.5)":"0 2px 4px rgba(0, 0, 0, 0.3)"},onMouseEnter:d=>{d.currentTarget.style.transform="scale(1.1)",d.currentTarget.style.borderColor="#F6DD58",d.currentTarget.style.boxShadow="0 4px 12px rgba(246, 221, 88, 0.4)"},onMouseLeave:d=>{d.currentTarget.style.transform="scale(1)",d.currentTarget.style.borderColor=o===t?"#F6DD58":"rgba(255, 255, 255, 0.2)",d.currentTarget.style.boxShadow=o===t?"0 4px 12px rgba(246, 221, 88, 0.5)":"0 2px 4px rgba(0, 0, 0, 0.3)"},children:e.jsx("img",{src:t,alt:`Avatar ${n+1}`,style:{width:"100%",height:"100%",objectFit:"cover"}})},n))})]}),r&&e.jsx("div",{style:{padding:"12px",background:"rgba(239, 68, 68, 0.1)",border:"1px solid rgba(239, 68, 68, 0.3)",borderRadius:"8px",color:"#fca5a5",fontSize:"14px",marginBottom:"20px"},children:r}),e.jsxs("div",{style:{display:"flex",gap:"12px",justifyContent:"flex-end"},children:[e.jsx("button",{onClick:x,disabled:s,style:{padding:"12px 24px",background:"rgba(255, 255, 255, 0.1)",color:"#a0aec0",border:"1px solid rgba(255, 255, 255, 0.2)",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:s?"not-allowed":"pointer",opacity:s?.5:1,transition:"all 0.2s"},onMouseEnter:t=>{s||(t.target.style.background="rgba(255, 255, 255, 0.15)",t.target.style.color="white")},onMouseLeave:t=>{t.target.style.background="rgba(255, 255, 255, 0.1)",t.target.style.color="#a0aec0"},children:"Cancel"}),e.jsx("button",{onClick:p,disabled:!o||s,style:{padding:"12px 24px",background:!o||s?"rgba(160, 174, 192, 0.3)":"linear-gradient(135deg, #0067AC 0%, #002147 100%)",color:!o||s?"#4a5568":"#F6DD58",border:!o||s?"1px solid rgba(160, 174, 192, 0.3)":"1px solid rgba(246, 221, 88, 0.3)",borderRadius:"8px",fontSize:"14px",fontWeight:"600",cursor:!o||s?"not-allowed":"pointer",transition:"all 0.3s ease",boxShadow:!o||s?"none":"0 4px 15px rgba(246, 221, 88, 0.3)"},onMouseEnter:t=>{o&&!s&&(t.target.style.borderColor="#F6DD58",t.target.style.boxShadow="0 6px 20px rgba(246, 221, 88, 0.4)")},onMouseLeave:t=>{o&&!s&&(t.target.style.borderColor="rgba(246, 221, 88, 0.3)",t.target.style.boxShadow="0 4px 15px rgba(246, 221, 88, 0.3)")},children:s?"Saving...":"Save Avatar"})]})]})]})}),document.body)]})};function N(){const b=I(),v=F(),[i,u]=g.useState(null),[f,y]=g.useState(null),[o,h]=g.useState(!1);g.useEffect(()=>{console.log("=== Sidebar useEffect running ==="),(async()=>{console.log("=== fetchUserData started ===");try{const a=localStorage.getItem("token"),l=localStorage.getItem("user");if(console.log("Token exists?",!!a),console.log("User in localStorage:",l),!l){console.log("âŒ No user in localStorage - STOPPING");return}const p=JSON.parse(l);console.log("Parsed localUser:",p);const x=p._id||p.id;if(console.log("User ID:",x),!x){console.error("âŒ No user ID found in localStorage user:",p);return}console.log("ðŸ”„ Fetching user data from API...");const t={"Content-Type":"application/json"};a&&(t.Authorization=`Bearer ${a}`),console.log("Fetch URL:",`https://molsongbsspaces.onrender.com/api/user/${x}`),console.log("Headers:",t);const n=await fetch(`https://molsongbsspaces.onrender.com/api/user/${x}`,{method:"GET",headers:t});if(console.log("ðŸ“¡ Response received"),console.log("Status:",n.status),console.log("OK?:",n.ok),!n.ok)throw console.error("âŒ API response not OK:",n.status,n.statusText),new Error(`Failed to fetch user data: ${n.status}`);const d=await n.json();console.log("âœ… Raw response data:",d);const c=d.data||d;console.log("âœ… Actual user data:",c),console.log("âœ… Image field:",c.image),u(c),y(c.image),localStorage.setItem("user",JSON.stringify(c)),console.log("âœ… Updated localStorage")}catch(a){console.error("âŒ Error in fetchUserData:",a),console.error("Error message:",a.message);const l=localStorage.getItem("user");if(l){const p=JSON.parse(l);console.log("âš ï¸ Using fallback localStorage data:",p),u(p),y(p.image||null)}}})()},[]),g.useEffect(()=>{h(!1)},[b.pathname]);const w=r=>{if(y(r),i){const a={...i,image:r};u(a),localStorage.setItem("user",JSON.stringify(a))}},j=()=>{localStorage.removeItem("token"),localStorage.removeItem("user"),v("/login")},s=[{path:"/home",label:"Home",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"})})},{path:"/map",label:"Office Map",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 20l-5.447-2.724A1 1 0 013 16.382V5.618a1 1 0 011.447-.894L9 7m0 13l6-3m-6 3V7m6 10l4.553 2.276A1 1 0 0021 18.382V7.618a1 1 0 00-.553-.894L15 4m0 13V4m0 0L9 7"})})},{path:"/bookings",label:"My Bookings",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"})})},{path:"/find-mate",label:"Find My Mate",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"})})}],k=i?.role==="admin"?[{path:"/admin/bookings",label:"ðŸ” Admin Bookings",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"})})},{path:"/admin/register",label:"ðŸ” Register Users",icon:e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M12 4v16m8-8H4"})})}]:[];return e.jsxs(e.Fragment,{children:[e.jsxs("button",{onClick:()=>h(!o),style:{position:"fixed",top:"1rem",left:"1rem",zIndex:1e4,display:"none",flexDirection:"column",justifyContent:"space-around",width:"2.5rem",height:"2.5rem",background:"linear-gradient(135deg, #0067AC 0%, #002147 100%)",border:"2px solid #F6DD58",borderRadius:"8px",cursor:"pointer",padding:"0.5rem",transition:"all 0.3s ease",boxShadow:"0 4px 12px rgba(0, 0, 0, 0.3)"},className:"mobile-menu-button",children:[e.jsx(m.span,{animate:{rotate:o?45:0,y:o?8:0},style:{width:"100%",height:"2px",background:"#F6DD58",borderRadius:"2px",transformOrigin:"center"}}),e.jsx(m.span,{animate:{opacity:o?0:1},style:{width:"100%",height:"2px",background:"#F6DD58",borderRadius:"2px"}}),e.jsx(m.span,{animate:{rotate:o?-45:0,y:o?-8:0},style:{width:"100%",height:"2px",background:"#F6DD58",borderRadius:"2px",transformOrigin:"center"}})]}),o&&e.jsx("div",{onClick:()=>h(!1),style:{position:"fixed",top:0,left:0,right:0,bottom:0,background:"rgba(0, 0, 0, 0.5)",zIndex:9998,display:"none"},className:"mobile-overlay"}),e.jsxs(m.div,{initial:{x:0},animate:{x:0},style:{width:"280px",minHeight:"100vh",background:"linear-gradient(to bottom, #2d3748, #1a202c)",display:"flex",flexDirection:"column",boxShadow:"4px 0 6px rgba(0, 0, 0, 0.1)",position:"relative",zIndex:9999,overflowY:"auto",WebkitOverflowScrolling:"touch"},className:"sidebar",children:[e.jsxs("div",{style:{padding:"2rem 1.5rem",borderBottom:"1px solid rgba(255, 255, 255, 0.1)",textAlign:"center"},children:[e.jsx(m.div,{initial:{scale:.8,opacity:0},animate:{scale:1,opacity:1},transition:{duration:.5},style:{width:"100px",height:"100px",margin:"0 auto 1rem",borderRadius:"50%",overflow:"hidden",border:"4px solid #F6DD58",boxShadow:"0 4px 6px rgba(0, 0, 0, 0.3)"},children:f?e.jsx("img",{src:f,alt:i?.name||"User avatar",style:{width:"100%",height:"100%",objectFit:"cover"}}):e.jsx("div",{style:{width:"100%",height:"100%",background:"linear-gradient(135deg, #0067AC, #002147)",display:"flex",alignItems:"center",justifyContent:"center",color:"white",fontSize:"2.5rem",fontWeight:"bold"},children:i?.name?i.name.charAt(0).toUpperCase():"N/A"})}),e.jsx("h3",{style:{color:"white",fontSize:"1.25rem",fontWeight:"bold",marginBottom:"0.25rem"},children:i?.name||"NOT LOGGED IN"}),e.jsxs("p",{style:{color:"#a0aec0",fontSize:"0.875rem",marginBottom:"1rem"},children:[i?.email||"not logged in"," Role:"+(i?.role?` ${i.role}`:" N/A")]}),e.jsx(T,{currentAvatar:f,onAvatarUpdate:w})]}),e.jsx("nav",{style:{flex:1,padding:"1.5rem 0"},children:[...s,...k].map(r=>{const a=b.pathname===r.path;return e.jsxs(C,{to:r.path,style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem 1.5rem",color:a?"white":"#a0aec0",textDecoration:"none",transition:"all 0.3s",backgroundColor:a?"rgba(0, 103, 172, 0.3)":"transparent",borderLeft:a?"4px solid #F6DD58":"4px solid transparent",fontWeight:a?"600":"400",fontSize:"1rem"},onMouseEnter:l=>{a||(l.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.05)",l.currentTarget.style.color="white")},onMouseLeave:l=>{a||(l.currentTarget.style.backgroundColor="transparent",l.currentTarget.style.color="#a0aec0")},children:[r.icon,e.jsx("span",{children:r.label})]},r.path)})}),e.jsxs("div",{style:{borderTop:"1px solid rgba(255, 255, 255, 0.1)",padding:"1rem 0"},children:[e.jsxs(C,{to:"/settings",style:{display:"flex",alignItems:"center",gap:"1rem",padding:"1rem 1.5rem",color:"#a0aec0",textDecoration:"none",transition:"all 0.3s",fontSize:"1rem"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(255, 255, 255, 0.05)",r.currentTarget.style.color="white"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent",r.currentTarget.style.color="#a0aec0"},children:[e.jsxs("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:[e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M10.325 4.317c.426-1.756 2.924-1.756 3.35 0a1.724 1.724 0 002.573 1.066c1.543-.94 3.31.826 2.37 2.37a1.724 1.724 0 001.065 2.572c1.756.426 1.756 2.924 0 3.35a1.724 1.724 0 00-1.066 2.573c.94 1.543-.826 3.31-2.37 2.37a1.724 1.724 0 00-2.572 1.065c-.426 1.756-2.924 1.756-3.35 0a1.724 1.724 0 00-2.573-1.066c-1.543.94-3.31-.826-2.37-2.37a1.724 1.724 0 00-1.065-2.572c-1.756-.426-1.756-2.924 0-3.35a1.724 1.724 0 001.066-2.573c-.94-1.543.826-3.31 2.37-2.37.996.608 2.296.07 2.572-1.065z"}),e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 12a3 3 0 11-6 0 3 3 0 016 0z"})]}),e.jsx("span",{children:"Settings"})]}),e.jsxs("button",{onClick:j,style:{display:"flex",alignItems:"center",gap:"1rem",width:"100%",padding:"1rem 1.5rem",color:"#ED1C24",backgroundColor:"transparent",border:"none",cursor:"pointer",transition:"all 0.3s",fontSize:"1rem",fontWeight:"500"},onMouseEnter:r=>{r.currentTarget.style.backgroundColor="rgba(237, 28, 36, 0.1)"},onMouseLeave:r=>{r.currentTarget.style.backgroundColor="transparent"},children:[e.jsx("svg",{className:"w-5 h-5",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:e.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"})}),e.jsx("span",{children:"Sign Out"})]})]})]}),e.jsx("style",{children:`
      @media (max-width: 768px) {
        .mobile-menu-button {
          display: flex !important;
        }
        
        .mobile-overlay {
          display: block !important;
        }
        
        .sidebar {
          position: fixed !important;
          top: 0;
          left: ${o?"0":"-280px"} !important;
          height: 100vh;
          transition: left 0.3s ease !important;
          overflow-y: auto !important;
          -webkit-overflow-scrolling: touch !important;
        }
      }
      
      @media (min-width: 769px) {
        .sidebar {
          position: relative !important;
        }
      }
    `})]})}function W(){return e.jsxs(e.Fragment,{children:[e.jsxs("div",{style:{display:"flex",minHeight:"100vh"},children:[e.jsx(N,{}),e.jsx("main",{style:{flex:1,overflow:"auto"},className:"main-content",children:e.jsx(z,{})})]}),e.jsx("style",{children:`
        @media (max-width: 768px) {
          .main-content {
            width: 100% !important;
            padding-top: 4rem;
          }
        }
      `})]})}export{W as default};
