import{r as u,j as e}from"./index-DgWF9MBv.js";import{m as s}from"./proxy-C2YUrH8b.js";function H(){const[g,m]=u.useState([]),[x,h]=u.useState(!1),[D,j]=u.useState(null);u.useEffect(()=>{h(!0);const n=setTimeout(()=>h(!1),700);return()=>clearTimeout(n)},[]),u.useEffect(()=>{(async()=>{h(!0);try{const o=localStorage.getItem("token"),d=localStorage.getItem("user");if(!d&&!o){console.warn("No user or token in localStorage — clearing bookings and skipping bookings fetch"),m([]),h(!1);return}console.log(o),console.log(d);let i=null;try{if(d){const r=JSON.parse(d);i=r._id||r.id||r.userId||null}}catch(r){console.warn("Failed to parse user from localStorage",r)}const c=window.location.hostname.includes("localhost")?"http://localhost:3000":"https://molsongbsspaces.onrender.com",w=new Date;w.setHours(w.getHours()-1);const S=w.toISOString();console.info("UTC timestamp to send (now -1h):",S);const B={...i?{userId:i}:{},timestamp:S,timestamp_utc:S},T="https://molsongbsspaces.onrender.com/api/user/positions";console.info("Fetching user bookings (onrender)",{fetchUrl:T,payload:B,hasToken:!!o}),j(null);const _={method:"POST",mode:"cors",credentials:"same-origin",headers:{"Content-Type":"application/json",...o?{Authorization:`Bearer ${o}`}:{}},body:JSON.stringify(B)},k=await fetch(T,_);if(!k.ok){const r=await k.text().catch(()=>"");throw new Error(`Failed fetching bookings: ${k.status} ${r}`)}const f=await k.json().catch(()=>null),l=f&&(f.data||f.bookings||f.positions||f)||[],z=r=>{if(!r)return"unknown";const t=String(r).toLowerCase();return t==="accepted"?"upcoming":t==="pending"?"pending":t==="declined"?"declined":t};if(Array.isArray(l)&&l.length>0&&l[0]&&(l[0].locationId||l[0].bookings)){const r=l.flatMap(p=>{const N=p.locationId||p.name||"";return(Array.isArray(p.bookings)?p.bookings:[]).map(a=>({id:a._id||a.id||null,deskName:N||a.deskName||a.locationName||"Desk",location:N||a.location||"",start:a.start||a.startTime||a.from||null,end:a.end||a.endTime||a.to||null,status:z(a.status||a.state||(a.approved?"accepted":a.pending?"pending":null))}))}),t=y(r);m(t),console.info(`Loaded ${t.length} bookings (flattened by location) from API`)}else{const r=t=>({id:t._id||t.id||t.bookingId||t.idBooking||null,deskName:t.deskName||t.desk&&(t.desk.name||t.desk.label)||t.locationName||t.section||t.deskId||"Desk",location:t.location||t.desk&&t.desk.location||t.locationName||"",start:t.startTime||t.start||t.from||t.timestamp||null,end:t.endTime||t.end||t.to||null,status:z(t.status||t.state||(t.approved?"accepted":(t.pending,"pending")))});if(Array.isArray(l)){const t=l.map(r),p=y(t);m(p),console.info(`Loaded ${p.length} bookings from API`)}else if(l&&typeof l=="object"){const t=[r(l)],p=y(t);m(p),console.info(`Loaded ${p.length} booking object from API`)}else console.warn("Unexpected bookings payload, clearing bookings",f),m([])}}catch(o){console.error("Error fetching user bookings:",o);const d=o&&o.message?o.message:String(o);j(d.includes("Failed to fetch")||d.includes("NetworkError")?"Network or CORS error while fetching bookings. Verify backend CORS allows this origin.":d)}finally{h(!1)}})()},[]);const C=g.filter(n=>(n.status||"pending")==="pending").length,I=g.filter(n=>n.status==="upcoming").length,L=g.filter(n=>n.status==="cancelled"||n.status==="declined").length,v=n=>{try{return new Date(n).toLocaleString(void 0,{month:"short",day:"numeric",year:"numeric",hour:"2-digit",minute:"2-digit"})}catch{return n}},A=n=>{if(!n)return"";const o=String(n);return o.length<=10?o:`${o.slice(0,8)}...`},y=n=>{if(!Array.isArray(n))return[];const o=Date.now();return n.map(i=>({...i,_endTs:(()=>{try{if(i.end==null)return null;if(typeof i.end=="number"&&Number.isFinite(i.end))return Number(i.end);if(i.end instanceof Date)return i.end.getTime();const c=Date.parse(String(i.end));return Number.isFinite(c)?c:null}catch{return null}})()})).filter(i=>i._endTs===null?!0:i._endTs>o).sort((i,c)=>i._endTs===null&&c._endTs===null?0:i._endTs===null?1:c._endTs===null?-1:c._endTs-i._endTs).map(({_endTs:i,...c})=>c)},W=(n="pending")=>{const o=String(n||"").toLowerCase();return o==="upcoming"||o==="accepted"||o==="approved"?{chipBg:"linear-gradient(135deg, #dcfce7, #bbf7d0)",chipBorder:"1px solid rgba(34, 197, 94, 0.35)",chipColor:"#166534",icon:"✓",label:"Accepted"}:o==="declined"||o==="cancelled"||o==="rejected"?{chipBg:"linear-gradient(135deg, #fee2e2, #fecaca)",chipBorder:"1px solid rgba(239, 68, 68, 0.35)",chipColor:"#991b1b",icon:"✗",label:"Declined"}:{chipBg:"linear-gradient(135deg, #fef3c7, #fde68a)",chipBorder:"1px solid rgba(251, 191, 36, 0.45)",chipColor:"#92400e",icon:"⏳",label:"Pending"}},b={background:"linear-gradient(135deg, #ffffff, #f8fafc)",border:"1px solid rgba(148, 163, 184, 0.25)",borderRadius:"16px",padding:"20px 28px",minWidth:"200px",boxShadow:"0 12px 24px rgba(15, 23, 42, 0.08)",textAlign:"center"};return e.jsxs("div",{className:"bookings-page",style:{minHeight:"100vh",background:"linear-gradient(135deg, #f8fafc 0%, #e0e7ff 45%, #dbeafe 100%)",padding:"40px 24px",position:"relative",overflow:"hidden"},children:[e.jsx("div",{style:{position:"absolute",top:0,left:0,right:0,bottom:0,opacity:.08,backgroundImage:`
            radial-gradient(circle at 12% 22%, rgba(0,103,172,0.35) 0%, transparent 22%),
            radial-gradient(circle at 88% 78%, rgba(246,221,88,0.35) 0%, transparent 22%),
            radial-gradient(circle at 50% 50%, rgba(2,132,199,0.25) 0%, transparent 28%)
          `,animation:"gradientShift 20s ease infinite",pointerEvents:"none"}}),e.jsxs("div",{className:"bookings-container",style:{maxWidth:"1400px",margin:"0 auto",position:"relative",zIndex:1},children:[e.jsx(s.div,{initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.5},style:{marginBottom:"36px"},children:e.jsx("div",{style:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",gap:"20px"},children:e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:"18px"},children:[e.jsx(s.div,{animate:{rotate:[0,4,-4,0],scale:[1,1.04,1]},transition:{duration:2.4,repeat:1/0,repeatDelay:3},style:{background:"linear-gradient(135deg, #0067AC, #1d4ed8)",borderRadius:"14px",padding:"14px",boxShadow:"0 10px 25px rgba(30, 64, 175, 0.25)"},children:e.jsxs("svg",{width:"30",height:"30",viewBox:"0 0 24 24",fill:"none",children:[e.jsx("path",{d:"M12 3L2 9L12 15L22 9L12 3Z",stroke:"#bfdbfe",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M4 10V17C4 17.5304 4.21071 18.0391 4.58579 18.4142C4.96086 18.7893 5.46957 19 6 19H10",stroke:"#bfdbfe",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M20 10V14",stroke:"#bfdbfe",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M13.5 18V21",stroke:"#bfdbfe",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"}),e.jsx("path",{d:"M10.5 18H16.5",stroke:"#bfdbfe",strokeWidth:"1.5",strokeLinecap:"round",strokeLinejoin:"round"})]})}),e.jsxs("div",{children:[e.jsx("h1",{style:{fontSize:"34px",fontWeight:"800",background:"linear-gradient(135deg, #0f172a, #1d4ed8)",WebkitBackgroundClip:"text",WebkitTextFillColor:"transparent",backgroundClip:"text",letterSpacing:"-0.4px",margin:0},children:"My Bookings"}),e.jsx("p",{style:{color:"#475569",margin:"6px 0 0 0",fontSize:"16px",fontWeight:"500"},children:"View and manage your desk and room bookings"})]})]})})}),e.jsxs(s.div,{className:"bookings-stats",initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{delay:.2},style:{display:"flex",gap:"24px",marginBottom:"40px",flexWrap:"wrap",justifyContent:"center"},children:[e.jsxs(s.div,{className:"stats-card",whileHover:{y:-4,boxShadow:"0 16px 32px rgba(96, 165, 250, 0.22)"},style:{...b,border:"1px solid rgba(59, 130, 246, 0.2)",background:"linear-gradient(135deg, #eff6ff, #f8fafc)"},children:[e.jsx("div",{style:{fontSize:"12px",textTransform:"uppercase",letterSpacing:"1.2px",fontWeight:"600",color:"#1d4ed8",marginBottom:"8px"},children:"Total Bookings"}),e.jsx("div",{style:{fontSize:"36px",fontWeight:"700",color:"#0f172a",letterSpacing:"-0.5px",marginBottom:"6px"},children:x?"...":g.length}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(15, 23, 42, 0.55)"},children:"All booking records fetched"})]}),e.jsxs(s.div,{className:"stats-card",whileHover:{y:-4,boxShadow:"0 16px 32px rgba(217, 119, 6, 0.18)"},style:{...b,border:"1px solid rgba(217, 119, 6, 0.25)",background:"linear-gradient(135deg, #fff7ed, #fffbeb)"},children:[e.jsx("div",{style:{fontSize:"12px",textTransform:"uppercase",letterSpacing:"1.2px",fontWeight:"600",color:"#b45309",marginBottom:"8px"},children:"Pending Review"}),e.jsx("div",{style:{fontSize:"36px",fontWeight:"700",color:"#92400e",letterSpacing:"-0.5px",marginBottom:"6px"},children:x?"...":C}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(180, 83, 9, 0.65)"},children:"Awaiting admin action"})]}),e.jsxs(s.div,{className:"stats-card",whileHover:{y:-4,boxShadow:"0 16px 32px rgba(34, 197, 94, 0.22)"},style:{...b,border:"1px solid rgba(34, 197, 94, 0.25)",background:"linear-gradient(135deg, #ecfdf5, #f0fdf4)"},children:[e.jsx("div",{style:{fontSize:"12px",textTransform:"uppercase",letterSpacing:"1.2px",fontWeight:"600",color:"#166534",marginBottom:"8px"},children:"Approved"}),e.jsx("div",{style:{fontSize:"36px",fontWeight:"700",color:"#14532d",letterSpacing:"-0.5px",marginBottom:"6px"},children:x?"...":I}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(22, 101, 52, 0.65)"},children:"Confirmed desk bookings"})]}),e.jsxs(s.div,{className:"stats-card",whileHover:{y:-4,boxShadow:"0 16px 32px rgba(248, 113, 113, 0.18)"},style:{...b,border:"1px solid rgba(248, 113, 113, 0.25)",background:"linear-gradient(135deg, #fef2f2, #fee2e2)"},children:[e.jsx("div",{style:{fontSize:"12px",textTransform:"uppercase",letterSpacing:"1.2px",fontWeight:"600",color:"#b91c1c",marginBottom:"8px"},children:"Declined"}),e.jsx("div",{style:{fontSize:"36px",fontWeight:"700",color:"#991b1b",letterSpacing:"-0.5px",marginBottom:"6px"},children:x?"...":L}),e.jsx("div",{style:{fontSize:"12px",color:"rgba(185, 28, 28, 0.65)"},children:"Marked as unavailable"})]})]}),x&&e.jsxs(s.div,{initial:{opacity:0},animate:{opacity:1},style:{background:"rgba(255, 255, 255, 0.85)",backdropFilter:"blur(14px)",border:"1px solid rgba(148, 163, 184, 0.25)",borderRadius:"20px",padding:"48px",textAlign:"center",boxShadow:"0 20px 45px rgba(15, 23, 42, 0.12)"},children:[e.jsx("div",{style:{width:"50px",height:"50px",border:"3px solid rgba(14, 116, 144, 0.2)",borderTop:"3px solid #1d4ed8",borderRadius:"50%",animation:"spin 1s linear infinite",margin:"0 auto 20px",boxShadow:"0 0 15px rgba(29, 78, 216, 0.25)"}}),e.jsx("p",{style:{color:"#475569",fontSize:"14px",margin:0,letterSpacing:"0.5px"},children:"Loading booking data..."})]}),!x&&g.length===0&&e.jsxs(s.div,{initial:{opacity:0,scale:.95},animate:{opacity:1,scale:1},transition:{duration:.4},style:{background:"rgba(255, 255, 255, 0.88)",backdropFilter:"blur(14px)",border:"1px solid rgba(148, 163, 184, 0.24)",borderRadius:"20px",padding:"70px 36px",textAlign:"center",boxShadow:"0 20px 45px rgba(15, 23, 42, 0.12)"},children:[e.jsx(s.div,{animate:{scale:[1,1.05,1]},transition:{duration:3,repeat:1/0,ease:"easeInOut"},style:{fontSize:"64px",marginBottom:"20px",filter:"drop-shadow(0 0 18px rgba(34, 197, 94, 0.35))"},children:"✓"}),e.jsx("h2",{style:{fontSize:"28px",color:"#0f172a",marginBottom:"10px",fontWeight:"600",letterSpacing:"-0.5px"},children:"All Clear"}),e.jsx("p",{style:{color:"#475569",fontSize:"14px",margin:0,letterSpacing:"0.3px"},children:"No booking requests require your attention"})]}),!x&&g.length>0&&e.jsx("div",{className:"booking-list",style:{display:"grid",gap:"24px"},children:g.map((n,o)=>{const d=n.id||`${n.deskName}-${o}`;return e.jsx(s.div,{className:"booking-card",initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{delay:o*.04},whileHover:{y:-4},style:{background:"linear-gradient(135deg, rgba(255,255,255,0.95), rgba(241,245,249,0.96))",border:"1px solid rgba(148,163,184,0.12)",padding:18,borderRadius:12,display:"grid",gridTemplateColumns:"1fr",gap:12,alignItems:"center"},children:e.jsxs("div",{children:[e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:12,marginBottom:8},children:[e.jsx("h4",{style:{margin:0,color:"#0f172a",fontSize:16},children:n.deskName}),(()=>{const i=W(n.status);return e.jsxs("span",{style:{background:i.chipBg,color:i.chipColor,padding:"6px 10px",borderRadius:9999,fontSize:12,fontWeight:700,border:i.chipBorder,display:"inline-flex",alignItems:"center",gap:"6px"},children:[i.icon," ",i.label]})})()]}),e.jsxs("div",{style:{color:"#475569",fontSize:14},children:["#",A(n.id)||n.location]}),e.jsxs("div",{style:{color:"#1e293b",marginTop:6,fontSize:13},children:[v(n.start)," • ",v(n.end)]})]})},d)})}),e.jsx(s.button,{className:"new-booking-fab",whileHover:{scale:1.02},whileTap:{scale:.98},style:{marginTop:20,padding:"12px 18px",background:"linear-gradient(90deg,#F6DD58,#ffbf00)",color:"#002147",border:"none",borderRadius:10,fontWeight:700,boxShadow:"0 8px 24px rgba(246,221,88,0.2)"},onClick:()=>window.location.href="/map",children:"+ New Booking"})]}),e.jsx("style",{children:`
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }
        @keyframes gradientShift { 0%,100%{transform:translate(0,0);}50%{transform:translate(30px,30px);} }

        /* Ensure the page chrome matches the component background to avoid a white bar on mobile */
        html, body, #root {
          height: 100%;
          margin: 0;
          background: linear-gradient(135deg, #f8fafc 0%, #e0e7ff 45%, #dbeafe 100%);
          -webkit-font-smoothing: antialiased;
          -moz-osx-font-smoothing: grayscale;
        }

        /* Component-level responsive helpers */
        .bookings-page { min-height: 100vh; padding: 40px 24px; box-sizing: border-box; }
        .bookings-container { max-width: 1400px; margin: 0 auto; position: relative; z-index: 1; }
        .bookings-stats { display: flex; gap: 24px; margin-bottom: 40px; flex-wrap: wrap; justify-content: center; }
        .stats-card { min-width: 180px; flex: 1 1 200px; border-radius: 16px; }

        .booking-list { display: grid; gap: 24px; }
        .booking-card { padding: 18px; border-radius: 12px; display: grid; grid-template-columns: 1fr auto; gap: 12px; align-items: center; }

        .new-booking-fab { position: static; }

        /* Mobile adjustments */
        @media (max-width: 768px) {
          .bookings-page { padding: 18px 12px; }
          .bookings-stats { gap: 12px; margin-bottom: 20px; }
          .stats-card { min-width: 140px; flex: 1 1 45%; padding: 12px 14px; }
          .booking-card { grid-template-columns: 1fr; padding: 12px; }
          .booking-card h4 { font-size: 15px; }
          .new-booking-fab { position: fixed; right: 18px; bottom: 18px; margin: 0; z-index: 60; border-radius: 12px; }
        }

        /* Tablet / small desktop */
        @media (min-width: 769px) and (max-width: 1200px) {
          .stats-card { min-width: 160px; flex: 1 1 30%; }
          .booking-list { grid-template-columns: 1fr; }
        }
      `})]})}export{H as default};
